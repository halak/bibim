<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE appendix [
  <!ENTITY % urls SYSTEM "../../entities/urls.ent">
  %urls;
]>

<appendix xmlns="http://docbook.org/ns/docbook"
          xmlns:xl="http://www.w3.org/1999/xlink"
          xml:id="appendix.parser">
  <info>
    <title>Parser Implementation</title>
    <abstract>
      <para>
        LitJSON was built out of a specific need for a small JSON library
        for the .Net framework, but also a big motivation was simply the fun
        of learning a little bit about parsing techniques and put some of
        that information into action writing a parser for the JSON grammar,
        which is not very complicated.
      </para>
      <para>
        This appendix includes some specific details about the approach used
        by the parser. This section should clarify some of the internal
        details of this library's source code.
      </para>
    </abstract>
  </info>
  <para>
    The parser in this library is based on a couple of elements: a finite
    state machine used to recognize tokens, and a pushdown automaton that
    recognizes the grammar of JSON text.
  </para>

  <section xml:id="appendix.parser.lexer">
    <title>Reading Tokens</title>

    <para>
      A finite state machine recognizes tokens from the input text, in
      effect acting as a lexer. It's composed of 28 states, listed below:
      <orderedlist>
        <listitem>
          <simpara>Default</simpara>
        </listitem>
        <listitem>
          <simpara>Number1</simpara>
        </listitem>
        <listitem>
          <simpara>Number2</simpara>
        </listitem>
        <listitem>
          <simpara>Number3</simpara>
        </listitem>
        <listitem>
          <simpara>Number4</simpara>
        </listitem>
        <listitem>
          <simpara>Number5</simpara>
        </listitem>
        <listitem>
          <simpara>Number6</simpara>
        </listitem>
        <listitem>
          <simpara>Number7</simpara>
        </listitem>
        <listitem>
          <simpara>True1</simpara>
        </listitem>
        <listitem>
          <simpara>True2</simpara>
        </listitem>
        <listitem>
          <simpara>True3</simpara>
        </listitem>
        <listitem>
          <simpara>False1</simpara>
        </listitem>
        <listitem>
          <simpara>False2</simpara>
        </listitem>
        <listitem>
          <simpara>False3</simpara>
        </listitem>
        <listitem>
          <simpara>False4</simpara>
        </listitem>
        <listitem>
          <simpara>Null1</simpara>
        </listitem>
        <listitem>
          <simpara>Null2</simpara>
        </listitem>
        <listitem>
          <simpara>Null3</simpara>
        </listitem>
        <listitem>
          <simpara>String1</simpara>
        </listitem>
        <listitem>
          <simpara>String2</simpara>
        </listitem>
        <listitem>
          <simpara>EscChar1</simpara>
        </listitem>
        <listitem>
          <simpara>EscChar2</simpara>
        </listitem>
        <listitem>
          <simpara>SingleQuotedString1</simpara>
        </listitem>
        <listitem>
          <simpara>SingleQuotedString2</simpara>
        </listitem>
        <listitem>
          <simpara>Comment</simpara>
        </listitem>
        <listitem>
          <simpara>SingleLineComment</simpara>
        </listitem>
        <listitem>
          <simpara>MultiLineComment1</simpara>
        </listitem>
        <listitem>
          <simpara>MultiLineComment2</simpara>
        </listitem>
      </orderedlist>
    </para>
    <para>
      As you may notice, the lexer is designed to read more than just the
      strict JSON grammar as defined in <link xl:href="&url.rfc4627;">RFC
      4627</link>. It may also allow comments (the forms
      <literal>//comment</literal> and <literal>/*comment*/</literal> are
      supported) and single-quoted strings. The library allows the developer
      to configure whether this extensions are accepted or not. They are
      allowed by default.
    </para>
    <para>
      A simple table lists which state to go to next depending on the
      current state and the current input character.
    </para>
    <para>
      Now, the actual handling of the states can do a little more than just
      setting the next state. The following flags are used to indicate
      special information related to the actions in a state:
    </para>
    <variablelist>
      <varlistentry>
        <term>A</term>
        <listitem>
          <para>
            Add char to buffer. A string buffer is kept and returned in
            certain states along with the token ID. For example, when
            reading a number, the entire sequence of characters
            corresponding to the number are returned as a string, along with
            the NUMBER token.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>C</term>
        <listitem>
          <para>
            Only accept this state if the lexer is configured to allow
            comments.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>E</term>
        <listitem>
          <para>
            Add the unescaped character to the buffer.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>L</term>
        <listitem>
          <para>
            Leave character unconsumed. This leaves the current input
            character untouched so it is used in the next lexer cycle.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>R</term>
        <listitem>
          <para>
            Return. This means that a token has been recognized, so the
            corresponding ID should be returned. If the string buffer is not
            empty, it should be returned as well, and then the buffer
            cleared.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>SQ</term>
        <listitem>
          <para>
            Only accept this state if the lexer is configured to allow
            string literals enclosed with single-quotes.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>SS</term>
        <listitem>
          <para>
            Stack State. When used as a flag, it indicates that the current
            state number should be put in a stack. When used as a state
            value, it means that the next state to go to is the one in the
            stack.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>U</term>
        <listitem>
          <para>
            Unicode escaping sequence. In this state, exactly 4 hex
            characters should be read and, at the end, the corresponding
            unicode character is added to the string buffer and the machine
            continues.
          </para>
        </listitem>
      </varlistentry>
    </variablelist>
    <para>
      One last thing to notice: the <token>Char</token> token means that the
      literal input character is returned as a token, except when it's a
      single quote (<literal>'</literal>), in which case the double quote
      (<literal>"</literal>) is returned. This is just to simplify things a
      little bit for the grammar parser.
    </para>

    <section xml:id="appendix.parser.lexer.table">
      <title>State Machine Table</title>

      <table>
        <title>Lexer State Machine (part one)</title>
        <tgroup cols="16" align="right">
          <thead>
            <row>
              <entry>Input</entry>
              <entry>State 1</entry>
              <entry>2</entry>
              <entry>3</entry>
              <entry>4</entry>
              <entry>5</entry>
              <entry>6</entry>
              <entry>7</entry>
              <entry>8</entry>
              <entry>9</entry>
              <entry>10</entry>
              <entry>11</entry>
              <entry>12</entry>
              <entry>13</entry>
              <entry>14</entry>
              <entry>15</entry>
            </row>
          </thead>
          <tfoot>
            <row>
              <entry>Token</entry>
              <entry><token>Char</token></entry>
              <entry></entry>
              <entry><token>NUMBER</token></entry>
              <entry><token>NUMBER</token></entry>
              <entry></entry>
              <entry><token>NUMBER</token></entry>
              <entry></entry>
              <entry><token>NUMBER</token></entry>
              <entry></entry>
              <entry></entry>
              <entry><token>TRUE</token></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry><token>FALSE</token></entry>
            </row>
          </tfoot>
          <tbody>
            <row>
              <entry><literal>space</literal></entry>
              <entry>1</entry>
              <entry></entry>
              <entry><literal>[R]</literal> 1</entry>
              <entry><literal>[R]</literal> 1</entry>
              <entry></entry>
              <entry><literal>[R]</literal> 1</entry>
              <entry></entry>
              <entry><literal>[R]</literal> 1</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>"</literal></entry>
              <entry><literal>[R]</literal> 19</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>'</literal></entry>
              <entry><literal>[SQ][R]</literal> 23</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>+</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>[A]</literal> 8</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>[,\]}]</literal></entry>
              <entry><literal>[R]</literal> 1</entry>
              <entry></entry>
              <entry><literal>[L][R]</literal> 1</entry>
              <entry><literal>[L][R]</literal> 1</entry>
              <entry></entry>
              <entry><literal>[L][R]</literal> 1</entry>
              <entry></entry>
              <entry><literal>[L][R]</literal> 1</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>-</literal></entry>
              <entry><literal>[A]</literal> 2</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>[A]</literal> 8</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>.</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>[A]</literal> 5</entry>
              <entry><literal>[A]</literal> 5</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>/</literal></entry>
              <entry><literal>[C]</literal> 25</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>0</literal></entry>
              <entry><literal>[A]</literal> 4</entry>
              <entry><literal>[A]</literal> 4</entry>
              <entry><literal>[A]</literal> 3</entry>
              <entry></entry>
              <entry><literal>[A]</literal> 6</entry>
              <entry><literal>[A]</literal> 6</entry>
              <entry><literal>[A]</literal> 8</entry>
              <entry><literal>[A]</literal> 8</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>[1-9]</literal></entry>
              <entry><literal>[A]</literal> 3</entry>
              <entry><literal>[A]</literal> 3</entry>
              <entry><literal>[A]</literal> 3</entry>
              <entry></entry>
              <entry><literal>[A]</literal> 6</entry>
              <entry><literal>[A]</literal> 6</entry>
              <entry><literal>[A]</literal> 8</entry>
              <entry><literal>[A]</literal> 8</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>:</literal></entry>
              <entry><literal>[R]</literal> 1</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>E</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>[A]</literal> 7</entry>
              <entry><literal>[A]</literal> 7</entry>
              <entry></entry>
              <entry><literal>[A]</literal> 7</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>[\[{]</literal></entry>
              <entry><literal>[R]</literal> 1</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>a</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry>13</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>e</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>[A]</literal> 7</entry>
              <entry><literal>[A]</literal> 7</entry>
              <entry></entry>
              <entry><literal>[A]</literal> 7</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>[R]</literal> 1</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>[R]</literal> 1</entry>
            </row>
            <row>
              <entry><literal>f</literal></entry>
              <entry>12</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>l</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry>14</entry>
              <entry></entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>n</literal></entry>
              <entry>16</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>r</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry>10</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>s</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry>15</entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>t</literal></entry>
              <entry>9</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>u</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry>11</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      <table>
        <title>Lexer State Machine (part two)</title>
        <tgroup cols="14" align="right">
          <thead>
            <row>
              <entry>Input</entry>
              <entry>State 16</entry>
              <entry>17</entry>
              <entry>18</entry>
              <entry>19</entry>
              <entry>20</entry>
              <entry>21</entry>
              <entry>22</entry>
              <entry>23</entry>
              <entry>24</entry>
              <entry>25</entry>
              <entry>26</entry>
              <entry>27</entry>
              <entry>28</entry>
            </row>
          </thead>
          <tfoot>
            <row>
              <entry>Token</entry>
              <entry></entry>
              <entry></entry>
              <entry><token>NULL</token></entry>
              <entry><token>CHARSEQ</token></entry>
              <entry><token>Char</token></entry>
              <entry></entry>
              <entry></entry>
              <entry><token>CHARSEQ</token></entry>
              <entry><token>Char</token></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
            </row>
          </tfoot>
          <tbody>
            <row>
              <entry><literal>\n</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry>1</entry>
              <entry>27</entry>
              <entry>27</entry>
            </row>
            <row>
              <entry><literal>"</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>[L][R]</literal> 20</entry>
              <entry><literal>[R]</literal> 1</entry>
              <entry><literal>[E]</literal> SS</entry>
              <entry></entry>
              <entry><literal>[A]</literal> 23</entry>
              <entry></entry>
              <entry></entry>
              <entry>26</entry>
              <entry>27</entry>
              <entry>27</entry>
            </row>
            <row>
              <entry><literal>'</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>[A]</literal> 19</entry>
              <entry></entry>
              <entry><literal>[E]</literal> SS</entry>
              <entry></entry>
              <entry><literal>[L][R]</literal> 24</entry>
              <entry><literal>[R]</literal> 1</entry>
              <entry></entry>
              <entry>26</entry>
              <entry>27</entry>
              <entry>27</entry>
            </row>
            <row>
              <entry><literal>*</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry>27</entry>
              <entry>26</entry>
              <entry>28</entry>
              <entry>28</entry>
            </row>
            <row>
              <entry><literal>/</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>[A]</literal> 19</entry>
              <entry></entry>
              <entry><literal>[E]</literal> SS</entry>
              <entry></entry>
              <entry><literal>[A]</literal> 23</entry>
              <entry></entry>
              <entry>26</entry>
              <entry>26</entry>
              <entry>27</entry>
              <entry>1</entry>
            </row>
            <row>
              <entry><literal>[0-9A-Facde]</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>[A]</literal> 19</entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>[U]</literal> SS</entry>
              <entry><literal>[A]</literal> 23</entry>
              <entry></entry>
              <entry></entry>
              <entry>26</entry>
              <entry>27</entry>
              <entry>27</entry>
            </row>
            <row>
              <entry><literal>\</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>[SS]</literal> 21</entry>
              <entry></entry>
              <entry><literal>[E]</literal> SS</entry>
              <entry></entry>
              <entry><literal>[SS]</literal> 21</entry>
              <entry></entry>
              <entry></entry>
              <entry>26</entry>
              <entry>27</entry>
              <entry>27</entry>
            </row>
            <row>
              <entry><literal>[bf]</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>[A]</literal> 19</entry>
              <entry></entry>
              <entry><literal>[E]</literal> SS</entry>
              <entry><literal>[U]</literal> SS</entry>
              <entry><literal>[A]</literal> 23</entry>
              <entry></entry>
              <entry></entry>
              <entry>26</entry>
              <entry>27</entry>
              <entry>27</entry>
            </row>
            <row>
              <entry><literal>l</literal></entry>
              <entry></entry>
              <entry>18</entry>
              <entry><literal>[R]</literal> 1</entry>
              <entry><literal>[A]</literal> 19</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>[A]</literal> 23</entry>
              <entry></entry>
              <entry></entry>
              <entry>26</entry>
              <entry>27</entry>
              <entry>27</entry>
            </row>
            <row>
              <entry><literal>[nrt]</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>[A]</literal> 19</entry>
              <entry></entry>
              <entry><literal>[E]</literal> SS</entry>
              <entry></entry>
              <entry><literal>[A]</literal> 23</entry>
              <entry></entry>
              <entry></entry>
              <entry>26</entry>
              <entry>27</entry>
              <entry>27</entry>
            </row>
            <row>
              <entry><literal>u</literal></entry>
              <entry>17</entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>[A]</literal> 19</entry>
              <entry></entry>
              <entry>22</entry>
              <entry></entry>
              <entry><literal>[A]</literal> 23</entry>
              <entry></entry>
              <entry></entry>
              <entry>26</entry>
              <entry>27</entry>
              <entry>27</entry>
            </row>
            <row>
              <entry><literal>other</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>[A]</literal> 19</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>[A]</literal> 23</entry>
              <entry></entry>
              <entry></entry>
              <entry>26</entry>
              <entry>27</entry>
              <entry>27</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </section>
  </section>

  <section xml:id="appendix.parser.grammar">
    <title>Grammar</title>

    <para>
      Since the lexer handles most of the hairy stuff (returning it as
      terminals), the resulting grammar deals mainly with the recursive
      portions.
    </para>

    <section xml:id="appendix.parser.grammar.ll">
      <title>LL(1) Form</title>

      <literallayout class="monospaced">
Text<subscript>S</subscript> -> Object
         | Array

Object  -> { Object'
Object' -> }
         | Pair PairRest }

PairRest -> &#949;
          | , Pair PairRest
Pair     -> String : Value

Array     -> [ Array'
Array'    -> ]
           | Value ValueRest ]
ValueRest -> &#949;
           | , Value ValueRest

Value -> String
       | Object
       | Array
       | NUMBER
       | TRUE
       | FALSE
       | NULL

String -> " CHARSEQ "
      </literallayout>
    </section>

    <section xml:id="appendix.parser.grammar.first">
      <title>FIRST(X) sets</title>

      <table>
        <title>Grammar FIRST(X) sets</title>
        <tgroup cols="2">
          <thead>
            <row>
              <entry>Rule</entry>
              <entry>FIRST set</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>Array</entry>
              <entry><literal>[</literal></entry>
            </row>
            <row>
              <entry>Array'</entry>
              <entry><literal>] " { [ NUMBER TRUE FALSE NULL</literal></entry>
            </row>
            <row>
              <entry>Object</entry>
              <entry><literal>{</literal></entry>
            </row>
            <row>
              <entry>Object'</entry>
              <entry><literal>} "</literal></entry>
            </row>
            <row>
              <entry>Pair</entry>
              <entry><literal>"</literal></entry>
            </row>
            <row>
              <entry>PairRest</entry>
              <entry><literal>&#949; ,</literal></entry>
            </row>
            <row>
              <entry>String</entry>
              <entry><literal>"</literal></entry>
            </row>
            <row>
              <entry>Text</entry>
              <entry><literal>{ [</literal></entry>
            </row>
            <row>
              <entry>Value</entry>
              <entry><literal>" { [ NUMBER TRUE FALSE NULL</literal></entry>
            </row>
            <row>
              <entry>ValueRest</entry>
              <entry><literal>&#949; ,</literal></entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </section>

    <section xml:id="appendix.parser.grammar.follow">
      <title>FOLLOW(X) sets</title>

      <para>
        Note: <literal>$</literal> is the end of input marker
      </para>
      <table>
        <title>Grammar FOLLOW(X) sets</title>
        <tgroup cols="2">
          <thead>
            <row>
              <entry>Rule</entry>
              <entry>FOLLOW set</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>Array</entry>
              <entry><literal>$ , ] }</literal></entry>
            </row>
            <row>
              <entry>Array'</entry>
              <entry><literal>$</literal></entry>
            </row>
            <row>
              <entry>CharList</entry>
              <entry><literal>"</literal></entry>
            </row>
            <row>
              <entry>Object</entry>
              <entry><literal>$ , ] }</literal></entry>
            </row>
            <row>
              <entry>Object'</entry>
              <entry><literal>$</literal></entry>
            </row>
            <row>
              <entry>Pair</entry>
              <entry><literal>, }</literal></entry>
            </row>
            <row>
              <entry>PairRest</entry>
              <entry><literal>}</literal></entry>
            </row>
            <row>
              <entry>String</entry>
              <entry><literal>: , ] }</literal></entry>
            </row>
            <row>
              <entry>Text</entry>
              <entry><literal>$</literal></entry>
            </row>
            <row>
              <entry>Value</entry>
              <entry><literal>, ] }</literal></entry>
            </row>
            <row>
              <entry>ValueRest</entry>
              <entry><literal>]</literal></entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </section>

    <section xml:id="appendix.parser.grammar.table">
      <title>Parse table</title>
      <table>
        <title>Parse Table</title>
        <tgroup cols="11" align="right">
          <thead>
            <row>
              <entry>Input Token</entry>
              <entry>Array</entry>
              <entry>Array'</entry>
              <entry>Object</entry>
              <entry>Object'</entry>
              <entry>Pair</entry>
              <entry>PairRest</entry>
              <entry>String</entry>
              <entry>Text</entry>
              <entry>Value</entry>
              <entry>ValueRest</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><literal>"</literal></entry>
              <entry></entry>
              <entry>Value ValueRest <literal>]</literal></entry>
              <entry></entry>
              <entry>Pair PairRest <literal>}</literal></entry>
              <entry>String <literal>:</literal> Value</entry>
              <entry></entry>
              <entry><literal>" CHARSEQ "</literal></entry>
              <entry></entry>
              <entry>String</entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>,</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>,</literal> Pair PairRest</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>,</literal> Value ValueRest</entry>
            </row>
            <row>
              <entry><literal>[</literal></entry>
              <entry><literal>[</literal> Array'</entry>
              <entry>Value ValueRest <literal>]</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry>Array</entry>
              <entry>Array</entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>]</literal></entry>
              <entry></entry>
              <entry><literal>]</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry>&#949;</entry>
            </row>
            <row>
              <entry><literal>{</literal></entry>
              <entry></entry>
              <entry>Value ValueRest <literal>]</literal></entry>
              <entry><literal>{</literal> Object'</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry>Object</entry>
              <entry>Object</entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>}</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>}</literal></entry>
              <entry></entry>
              <entry>&#949;</entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>NUMBER</literal></entry>
              <entry></entry>
              <entry>Value ValueRest <literal>]</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>NUMBER</literal></entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>TRUE</literal></entry>
              <entry></entry>
              <entry>Value ValueRest <literal>]</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>TRUE</literal></entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>FALSE</literal></entry>
              <entry></entry>
              <entry>Value ValueRest <literal>]</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>FALSE</literal></entry>
              <entry></entry>
            </row>
            <row>
              <entry><literal>NULL</literal></entry>
              <entry></entry>
              <entry>Value ValueRest <literal>]</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry></entry>
              <entry><literal>NULL</literal></entry>
              <entry></entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </section>

  </section>

</appendix>
